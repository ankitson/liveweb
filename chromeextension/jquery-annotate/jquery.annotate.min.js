(function(){jQuery.fn.bounds=function(){var a={left:Number.POSITIVE_INFINITY,top:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY,bottom:Number.NEGATIVE_INFINITY,width:Number.NaN,height:Number.NaN};this.each(function(b,d){var c=$(d);var e=c.offset();e.right=e.left+$(c).width();e.bottom=e.top+$(c).height();if(e.left<a.left){a.left=e.left}if(e.top<a.top){a.top=e.top}if(e.right>a.right){a.right=e.right}if(e.bottom>a.bottom){a.bottom=e.bottom}});a.width=a.right-a.left;a.height=a.bottom-a.top;return a}})();(function(b){var a={init:function(c){var d=b(this),f=d.data("annotate");if(!f){var e={add:"",tpl:"",container:d,dblclick:false,confirmDelete:"Are you sure?",opt_draggable:{containment:"parent",stack:".annotate"},opt_resizable:{start:function(){b(this).annotate("front")},maxWidth:200,maxHeight:250,minHeight:100,minWidth:100,autoHide:true,containment:"parent"}};if(c){f=b.extend(e,c)}b(this).data("annotate",e)}f=b(this).data("annotate");tpl=b(f.tpl);d.droppable({accept:".annotate"});if("undefined"!=typeof(f.add)){b(f.add).click(function(g){d.annotate("add")})}if(f.dblclick){d.dblclick(function(g){b(this).annotate("add",{top:g.pageY,left:g.pageX})})}},add:function(c){var d=b(this).data("annotate");var e=b(d.tpl).clone();e.attr("id","").appendTo(d.container);e.draggable(d.opt_draggable);e.resizable(d.opt_resizable);e.addClass("annotate-note");if("undefined"==typeof(c)){var c={}}if("undefined"==typeof(c.top)){c.top=0}if("undefined"==typeof(c.bottom)){c.bottom=0}e.css({top:c.top,left:c.left});if(c.content){e.find("textarea").val(c.content)}if(c.height){e.css("height",c.height)}if(c.width){e.css("width",c.width)}if(c.zIndex){e.css("z-index",c.zIndex)}e.find("a.annotate-close").click(function(){if(b(this).parents(".annotate").find("textarea").val()==""||!d.confirmDelete||(d.confirmDelete&&confirm(d.confirmDelete))){b(this).parents(".annotate").remove()}});e.hover(function(){b(this).find(".annotate-close").css("display","inline")},function(){b(this).find(".annotate-close").css("display","none")});e.click(function(){b(this).annotate("front")})},front:function(){b(".annotate").css({"z-index":1});b(this).css({"z-index":100})},serialize:function(){var c=[];b(".annotate-note").each(function(){var d=b(this);var e=d.bounds();e.content=d.find("textarea").val();e.zIndex=d.css("z-index");c.push(e)});return c},load:function(d){var c=b(this);b.each(d,function(){c.annotate("add",this)})},reset:function(){var c=b(this).data("annotate");b(c.container).find(".annotate").remove()}};b.fn.annotate=function(c){if(a[c]){return a[c].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof c==="object"||!c){return a.init.apply(this,arguments)}else{if(console.log){console.log("Method "+c+" does not exist on jQuery.annotate")}}}return this}})(jQuery);